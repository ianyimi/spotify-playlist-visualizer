/*
Auto-generated by: https://github.com/pmndrs/gltfjsx
Command: npx gltfjsx@6.5.3 ./public/staging/vintageTelevision.glb -d -t -v -p 4 
*/

import { useValue } from '@legendapp/state/react'
import { Box, Html, MeshPortalMaterial, RenderTexture, useGLTF } from '@react-three/drei'
import { useControls } from "leva"
import { useEffect, useRef, useState } from 'react'
import { type Mesh, MeshBasicMaterial, type MeshStandardMaterial } from 'three'
import { type GLTF } from 'three-stdlib'

import type { GroupProps } from '~/types'

import AuthCard from '~/app/(frontend)/auth/[pathname]/view'
import CameraShake from '~/components/Canvas/CameraShake'
import { $sceneStore } from '~/stores/scene'
import { cn } from '~/styles/utils'
import { Button } from '~/ui/button'

import Playlists from '../Canvas/Playlists'
import TransitionMaterial from '../TransitionMaterial'

type GLTFResult = GLTF & {
	materials: {
		['TV_Chayka-206']: MeshStandardMaterial
	}
	nodes: {
		TV: Mesh
		TVSCREEN: Mesh
		TVSCREENBEZEL: Mesh
	}
}

export default function InitialScene(props: GroupProps) {
	const { materials, nodes } = useGLTF('tv.glb') as unknown as GLTFResult
	const [hover, setHover] = useState(false)
	const transitionProgress = useValue($sceneStore.sceneDepth.transitionProgress)
	const screenMesh = useRef<Mesh>(null)
	const { progress } = useControls({
		progress: { max: 1, min: 0, value: 0 }
	})
	return (
		<group {...props} dispose={null}>
			<mesh geometry={nodes.TV.geometry} material={materials['TV_Chayka-206']} position={[-0.0011, 0.0054, -0.0071]} scale={5.0041} />
			<mesh geometry={nodes.TVSCREEN.geometry} position={[-0.0011, 0.0054, -0.0071]} ref={screenMesh} scale={5.0809}>
				<TransitionMaterial transitionProgress={progress}>
					<RenderTexture attach="textureA">
						{/* <Playlists position={[0, 0, -25]} /> */}
						<Box args={[1, 1, 1]} material={new MeshBasicMaterial({ color: "green" })} position={[1, -1, 1]} />
						<ambientLight intensity={1} />
						<color args={["#00ff00"]} attach="background" />
						{/* <CameraShake /> */}
					</RenderTexture>
					<RenderTexture attach="textureB">
						<Playlists position={[0, -7, -25]} />
						<ambientLight intensity={1} />
						<directionalLight intensity={1} position={[5, 5, 5]} />
						<color args={["#050505"]} attach="background" />
						{/* <CameraShake /> */}
					</RenderTexture>
				</TransitionMaterial>
				{progress === 1 && <MeshPortalMaterial blend={progress} blur={0.2} resolution={1024}>
					<Playlists position={[-5, 0, -5]} />
					{/* <Box args={[0.5, 0.5, 0.5]} material={new MeshBasicMaterial({ color: hover ? "yellow" : "purple" })} onPointerOut={() => setHover(false)} onPointerOver={() => setHover(true)} position={[0, 0.2, 0]} /> */}
					<ambientLight intensity={1} />
					<directionalLight intensity={1} position={[5, 5, 5]} />
					{/* <CameraShake /> */}
				</MeshPortalMaterial>}
			</mesh>
			<mesh geometry={nodes.TVSCREENBEZEL.geometry} material={materials['TV_Chayka-206']} position={[-0.4388, 1.2966, 0.8396]} scale={[5.1008, 5.1032, 4.9647]} />
		</group>
	)
}

useGLTF.preload('tv.glb')
